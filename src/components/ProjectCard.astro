---
// src/components/ProjectCard.astro
const { project } = Astro.props;
---

<!-- Добавляем класс project-card для JS-скрипта -->
<article class="project-card group relative h-full flex flex-col rounded-2xl bg-[var(--color-card)] border border-[var(--color-border)] overflow-hidden transition-transform duration-300 hover:-translate-y-1">
  
  <!-- 1. SPOTLIGHT ЭФФЕКТ (Тот же, что в Hero) -->
  <div
    class="pointer-events-none absolute -inset-px opacity-0 transition-opacity duration-300 group-hover:opacity-100"
    style="background: radial-gradient(400px circle at var(--mouse-x) var(--mouse-y), rgba(129, 140, 248, 0.15), transparent 40%); z-index: 0;"
  ></div>

  <!-- 2. ГРАНИЦА ПРИ НАВЕДЕНИИ -->
  <div
    class="pointer-events-none absolute -inset-px opacity-0 transition-opacity duration-300 group-hover:opacity-100"
    style="background: radial-gradient(400px circle at var(--mouse-x) var(--mouse-y), var(--color-primary), transparent 40%); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; z-index: 0;"
  ></div>

  <div class="relative z-10 flex flex-col h-full bg-[var(--color-card)]/80 backdrop-blur-sm rounded-[15px] overflow-hidden">
    
    <!-- Изображение -->
    {project.imageUrl && (
      <div class="relative h-48 overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-t from-[var(--color-card)] to-transparent z-10 opacity-80"></div>
        
        {project.featured && (
          <div class="absolute top-3 right-3 z-20 px-2.5 py-1 rounded-full bg-[var(--color-primary)]/90 text-white text-[10px] font-bold uppercase tracking-wider shadow-lg backdrop-blur-md">
            <span class="lang-ru">TOP</span>
            <span class="lang-en">TOP</span>
          </div>
        )}
        
        <img 
          src={project.imageUrl} 
          alt={project.title.en} 
          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" 
          loading="lazy"
        />
      </div>
    )}

    <!-- Контент -->
    <div class="p-6 flex flex-col flex-grow">
      <h3 class="text-xl font-bold font-cinzel text-[var(--color-foreground)] mb-2 group-hover:text-[var(--color-primary)] transition-colors">
        <span class="lang-ru">{project.title.ru}</span>
        <span class="lang-en">{project.title.en}</span>
      </h3>

      <!-- УЛУЧШЕНИЕ КОНТРАСТА: text-gray-400 вместо muted-foreground для лучшей читаемости на темном -->
      <p class="text-gray-500 dark:text-gray-300 text-sm flex-grow mb-5 leading-relaxed line-clamp-3">
        <span class="lang-ru">{project.description.ru}</span>
        <span class="lang-en">{project.description.en}</span>
      </p>

      <!-- Теги -->
      <div class="flex flex-wrap gap-2 mb-6">
        {project.tags.slice(0, 4).map((tag: string) => (
          <span class="px-2 py-1 text-[10px] uppercase font-semibold tracking-wide rounded bg-[var(--color-primary)]/10 text-[var(--color-primary)] border border-[var(--color-primary)]/20">
            {tag}
          </span>
        ))}
      </div>

      <!-- Ссылки (Icons only for cleaner look) -->
      <div class="mt-auto flex items-center gap-4 pt-4 border-t border-[var(--color-border)]">
        {project.codeUrl && (
          <a href={project.codeUrl} target="_blank" class="text-gray-400 hover:text-white transition-colors" title="Code">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          </a>
        )}
        <div class="flex-grow"></div>
        <a href={project.caseStudyUrl || project.demoUrl || '#'} class="text-sm font-semibold text-[var(--color-primary)] hover:underline flex items-center gap-1">
          <span class="lang-ru">Подробнее</span>
          <span class="lang-en">Details</span>
          →
        </a>
      </div>
    </div>
  </div>
</article>

<!-- Скрипт для Spotlight эффекта на карточках -->
<script>
  function initProjectCards() {
    const cards = document.querySelectorAll(".project-card");
    
    cards.forEach((card) => {
      // @ts-ignore
      card.addEventListener("mousemove", (e) => {
        // @ts-ignore
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        // @ts-ignore
        card.style.setProperty("--mouse-x", `${x}px`);
        // @ts-ignore
        card.style.setProperty("--mouse-y", `${y}px`);
      });
    });
  }
  
  // Инициализация при загрузке и переходах Astro
  document.addEventListener("DOMContentLoaded", initProjectCards);
  document.addEventListener("astro:page-load", initProjectCards);
</script>