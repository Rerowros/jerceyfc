---
// src/components/Header.astro
import HeaderControls from "./HeaderControls.astro";
---

<header
  class="fixed top-0 left-0 right-0 z-50 glass-card border-t-0 border-x-0 rounded-none backdrop-blur-xl"
>
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-center h-16">
      <!-- Лого/Имя -->
      <a
        href="/"
        class="relative z-50 inline-flex items-center text-xl md:text-2xl font-bold font-cinzel hover:opacity-80 transition-opacity"
      >
        <!-- Класс text-gradient перенесен сюда -->
        <span class="lang-ru text-gradient">Jersey</span>
      </a>

      <!-- Контролы для десктопа -->
      <div class="hidden md:flex items-center gap-6">
        <nav
          class="flex gap-6 font-medium text-[var(--color-muted-foreground)]"
        >
          <a
            href="/#skills"
            class="hover:text-[var(--color-primary)] transition-colors"
          >
            <span class="lang-ru">Навыки</span><span class="lang-en"
              >Skills</span
            >
          </a>
          <a
            href="/about"
            class="hover:text-[var(--color-primary)] transition-colors"
          >
            <span class="lang-ru">Обо мне</span><span class="lang-en"
              >About</span
            >
          </a>
          <a
            href="/projects"
            class="hover:text-[var(--color-primary)] transition-colors"
          >
            <span class="lang-ru">Проекты</span><span class="lang-en"
              >Projects</span
            >
          </a>
        </nav>
        <HeaderControls />
      </div>

      <!-- Кнопка бургер-меню для мобильных (Redesigned) -->
      <div class="md:hidden flex items-center">
        <button
          id="mobile-menu-button"
          class="group relative h-10 w-10 rounded-xl bg-[var(--color-card)] border border-[var(--color-border)] flex flex-col items-center justify-center gap-[5px] hover:border-[var(--color-primary)] transition-colors overflow-hidden"
          aria-label="Открыть меню"
        >
          <!-- Glow effect background -->
          <div
            class="absolute inset-0 bg-[var(--color-primary)]/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
          >
          </div>

          <!-- Animated Lines -->
          <span
            class="line-1 w-5 h-0.5 bg-[var(--color-foreground)] rounded-full transition-all duration-300 origin-center"
          ></span>
          <span
            class="line-2 w-5 h-0.5 bg-[var(--color-foreground)] rounded-full transition-all duration-300 origin-center"
          ></span>
          <span
            class="line-3 w-5 h-0.5 bg-[var(--color-foreground)] rounded-full transition-all duration-300 origin-center"
          ></span>
        </button>
      </div>
    </div>
  </div>

  <!-- Выпадающее меню для мобильных -->
  <div
    id="mobile-menu"
    class="hidden md:hidden glass-card border-t border-[var(--color-border)] overflow-hidden transition-all duration-300 origin-top"
  >
    <nav class="container px-4 py-6 space-y-4">
      <div class="space-y-2">
        <a
          href="/#skills"
          class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--color-foreground)]/5 text-[var(--color-muted-foreground)] hover:text-[var(--color-primary)] transition-all"
        >
          <span class="text-lg font-medium"
            ><span class="lang-ru">Навыки</span><span class="lang-en"
              >Skills</span
            ></span
          >
        </a>
        <a
          href="/about"
          class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--color-foreground)]/5 text-[var(--color-muted-foreground)] hover:text-[var(--color-primary)] transition-all"
        >
          <span class="text-lg font-medium"
            ><span class="lang-ru">Обо мне</span><span class="lang-en"
              >About</span
            ></span
          >
        </a>
        <a
          href="/projects"
          class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--color-foreground)]/5 text-[var(--color-muted-foreground)] hover:text-[var(--color-primary)] transition-all"
        >
          <span class="text-lg font-medium"
            ><span class="lang-ru">Проекты</span><span class="lang-en"
              >Projects</span
            ></span
          >
        </a>
      </div>

      <!-- Мобильная версия HeaderControls -->
      <div class="pt-4 border-t border-[var(--color-border)] space-y-5">
        <!-- Цветовая палитра -->
        <div class="flex items-center justify-between p-1">
          <span
            class="text-sm font-medium text-[var(--color-muted-foreground)]"
          >
            <span class="lang-ru">Цветовая схема</span><span class="lang-en"
              >Color scheme</span
            >
          </span>
          <div id="palette-switcher-mobile" class="flex items-center gap-3">
            <button
              data-theme="indigo"
              class="h-6 w-6 rounded-full bg-[#818cf8] ring-offset-[var(--color-card)] ring-offset-2 focus:ring-2 ring-white/20 transition-all hover:scale-110 active:scale-95 shadow-lg shadow-indigo-500/20"
              title="Indigo"></button>
            <button
              data-theme="lavender"
              class="h-6 w-6 rounded-full bg-[#c084fc] ring-offset-[var(--color-card)] ring-offset-2 focus:ring-2 ring-white/20 transition-all hover:scale-110 active:scale-95 shadow-lg shadow-purple-500/20"
              title="Lavender"></button>
            <button
              data-theme="mint"
              class="h-6 w-6 rounded-full bg-[#34d399] ring-offset-[var(--color-card)] ring-offset-2 focus:ring-2 ring-white/20 transition-all hover:scale-110 active:scale-95 shadow-lg shadow-emerald-500/20"
              title="Mint"></button>
            <button
              data-theme="sunny"
              class="h-6 w-6 rounded-full bg-[#fbbf24] ring-offset-[var(--color-card)] ring-offset-2 focus:ring-2 ring-white/20 transition-all hover:scale-110 active:scale-95 shadow-lg shadow-amber-500/20"
              title="Sunny"></button>
            <button
              data-theme="rose"
              class="h-6 w-6 rounded-full bg-[#fb7185] ring-offset-[var(--color-card)] ring-offset-2 focus:ring-2 ring-white/20 transition-all hover:scale-110 active:scale-95 shadow-lg shadow-rose-500/20"
              title="Rose"></button>
          </div>
        </div>

        <!-- Язык и тема -->
        <div class="flex items-center gap-3">
          <button
            id="lang-toggle-mobile"
            class="flex-1 font-cinzel font-bold text-sm px-4 py-3 rounded-xl bg-[var(--color-background)]/50 border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all active:scale-95"
          >
            <span class="lang-ru">Switch to English</span>
            <span class="lang-en">Переключить на RU</span>
          </button>

          <button
            id="theme-toggle-mobile"
            class="w-12 h-12 flex items-center justify-center rounded-xl bg-[var(--color-background)]/50 border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-all active:scale-95"
          >
            <span
              id="theme-icon-mobile"
              class="theme-icon inline-block relative w-5 h-5"
            >
              <svg
                class="absolute inset-0 w-full h-full"
                viewBox="0 0 32 32"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <!-- Updated to match desktop icon structure and styles -->
                <g
                  id="sun-group-mobile"
                  class="origin-center transition-all duration-500 ease-out"
                >
                  <circle cx="16" cy="16" r="6" fill="currentColor"></circle>
                  <path
                    d="M16 4L16 8M16 24L16 28M4 16L8 16M24 16L28 16M7.76 7.76L10.34 10.34M21.66 21.66L24.24 24.24M7.76 24.24L10.34 21.66M21.66 10.34L24.24 7.76"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"></path>
                </g>
                <g
                  id="moon-group-mobile"
                  class="origin-center transition-all duration-500 ease-out"
                >
                  <path
                    d="M16 8a8 8 0 1 0 8 8c-4.42 0-8-3.58-8-8z"
                    fill="currentColor"></path>
                </g>
              </svg>
            </span>
          </button>
        </div>
      </div>
    </nav>
  </div>
</header>

<style>
  /* Burger Button Animations */
  #mobile-menu-button.is-active .line-1 {
    transform: translateY(7px) rotate(45deg);
  }

  #mobile-menu-button.is-active .line-2 {
    opacity: 0;
    transform: translateX(10px);
  }

  #mobile-menu-button.is-active .line-3 {
    transform: translateY(-7px) rotate(-45deg);
  }

  /* Ensure text gradient works */
  .text-gradient {
    display: inline-block; /* Helps with background-clip: text */
  }
</style>

<script>
  function initMobileHeader() {
    // 1. Мобильное меню (бургер)
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");

    if (mobileMenuButton && mobileMenu) {
      const toggleMenu = () => {
        mobileMenu.classList.toggle("hidden");
        mobileMenuButton.classList.toggle("is-active");

        // Prevent body scroll when menu is open
        if (!mobileMenu.classList.contains("hidden")) {
          document.body.style.overflow = "hidden";
        } else {
          document.body.style.overflow = "";
        }
      };

      mobileMenuButton.onclick = toggleMenu;

      // Закрытие при клике на ссылку
      mobileMenu.querySelectorAll("a").forEach((link) => {
        link.onclick = () => {
          mobileMenu.classList.add("hidden");
          mobileMenuButton.classList.remove("is-active");
          document.body.style.overflow = "";
        };
      });
    }

    // 2. Мобильная палитра
    const paletteMobile = document.getElementById("palette-switcher-mobile");
    if (paletteMobile) {
      const updateActive = () => {
        const current =
          document.documentElement.getAttribute("data-theme") || "indigo";
        paletteMobile.querySelectorAll("button").forEach((btn) => {
          // @ts-ignore
          const isActive = btn.dataset.theme === current;
          btn.classList.toggle("ring-2", isActive);
          btn.classList.toggle("ring-[var(--color-primary)]", isActive); // Changed from white to primary for visibility
        });
      };
      updateActive();

      paletteMobile.onclick = (e) => {
        // @ts-ignore
        const theme = e.target?.dataset?.theme;
        if (theme) {
          document.documentElement.setAttribute("data-theme", theme);
          localStorage.setItem("palette", theme);
          updateActive();
        }
      };
    }

    // 3. Мобильный язык
    const langMobile = document.getElementById("lang-toggle-mobile");
    if (langMobile) {
      langMobile.onclick = () => {
        const newLang = document.documentElement.lang === "ru" ? "en" : "ru";
        document.documentElement.lang = newLang;
        localStorage.setItem("lang", newLang);
        // Анимация handled by global observer or CSS
      };
    }

    // 4. Мобильная тема
    const themeMobile = document.getElementById("theme-toggle-mobile");
    if (themeMobile) {
      const icon = document.getElementById("theme-icon-mobile");
      const sun = icon?.querySelector("#sun-group-mobile");
      const moon = icon?.querySelector("#moon-group-mobile");

      const updateIcon = (isLight: boolean) => {
        if (sun && moon) {
          // @ts-ignore
          sun.style.opacity = isLight ? "1" : "0";
          // @ts-ignore
          moon.style.opacity = isLight ? "0" : "1";
        }
      };
      updateIcon(document.documentElement.classList.contains("light"));

      themeMobile.onclick = () => {
        const isLight = document.documentElement.classList.toggle("light");
        localStorage.setItem("theme", isLight ? "light" : "dark");
        updateIcon(isLight);
      };
    }
  }

  document.addEventListener("astro:page-load", initMobileHeader);
  document.addEventListener("DOMContentLoaded", initMobileHeader);
</script>
