---
// src/layouts/Layout.astro
import '../styles/global.css';
import '../styles/lang-animate.css';
import { ClientRouter } from 'astro:transitions';
import Background from '../components/ui/Background.astro';
interface Props {
  title?: string;
  description?: string;
  pathname?: string;
}
const { title = 'Портфолио | Jersey', description = 'Портфолио Jersey — разработчик веб-приложений, Telegram-ботов и десктоп-приложений. Проекты и исходный код.', pathname = '/' } = Astro.props;
---
<!doctype html>
<html lang="ru" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content="dark light">
    <meta name="darkreader-lock">
    <title>{title} | Jersey</title>
    <!-- Мета-теги остались без изменений... -->
    <link rel="canonical" href={`https://jerceyfc.ru${pathname}`} />
    <meta property="og:locale" content="ru_RU" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={`${title} | Jersey`} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={`https://jerceyfc.ru${pathname}`} />
    <meta property="og:image" content="/J.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@jerseyfc" />
    <meta name="twitter:title" content={`${title} | Jersey`} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="/J.png" />

    <!-- JSON-LD... -->
    <script type="application/ld+json" is:inline>
      {JSON.stringify({
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "Person",
            "name": "Jersey",
            "url": "https://jerceyfc.ru/",
            "sameAs": ["https://t.me/jerseyfc", "https://github.com/Rerowros"],
            "jobTitle": "Software Developer",
            "description": "Разработчик веб-приложений, Telegram-ботов и десктоп-приложений."
          },
          {
            "@type": "WebSite",
            "name": "Jersey — Portfolio",
            "url": "https://jerceyfc.ru/",
            "potentialAction": {
              "@type": "SearchAction",
              "target": "https://jerceyfc.ru/?s={search_term_string}",
              "query-input": "required name=search_term_string"
            }
          }
        ]
      })}
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200..900&family=Manrope:wght@200..800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="/J.png" />

    <meta name="view-transition" content="same-origin" />
    <ClientRouter />

  <script>
    import { applyTheme } from '../scripts/theme';
    applyTheme();
    // Astro View Transitions могут сбрасывать состояние html тега, поэтому подстрахуемся
    document.addEventListener('astro:after-swap', applyTheme);
  </script>
  </head>
<body class="font-['Inter'] antialiased selection:bg-primary/30">
  <Background />
  <main class="relative z-10 w-full overflow-x-hidden">
    <slot />
  </main>
  
  <!-- Скрипт Scroll Animation Observer перенесен сюда, так как он глобальный -->
  <script>
    function initScrollObserver() {
      const animatedElements = document.querySelectorAll('.scroll-animate');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });
      animatedElements.forEach(element => observer.observe(element));
    }
    
    document.addEventListener('astro:page-load', initScrollObserver);
    document.addEventListener('DOMContentLoaded', initScrollObserver);
  </script>

  <script>
  import { initMagneticButtons } from '../scripts/magnetic';

  // Запускаем при загрузке и при переходах между страницами
  document.addEventListener('astro:page-load', initMagneticButtons);
  document.addEventListener('DOMContentLoaded', initMagneticButtons);
  </script>

</body>
</html>