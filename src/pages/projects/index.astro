---
// src/pages/projects/index.astro
import { getCollection } from "astro:content";
import { slide } from "astro:transitions";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/layout/Header.astro";
import ProjectCard from "../../components/ui/ProjectCard.astro";
import Footer from "../../components/layout/Footer.astro";

const allProjects = await getCollection("projects");

// Сортировка: сначала featured, потом по дате
const sortedProjects = allProjects.sort((a, b) => {
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  return b.data.pubDate.valueOf() - a.data.pubDate.valueOf();
});
---

<Layout
  title="Проекты"
  description="Кейсы и проекты: Telegram Stars, LiteForce, и другие."
  pathname="/projects"
>
  <Header />
  <main
    class="container pt-24 md:pt-32 pb-16 min-h-screen"
    transition:animate={slide({ duration: "0.3s" })}
  >
    <!-- Заголовок -->
    <div class="text-center mb-20 relative">
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-32 bg-[var(--color-primary)]/20 blur-[100px] -z-10 rounded-full"
      >
      </div>

      <h1
        class="text-5xl md:text-7xl font-extrabold tracking-tight font-cinzel mb-6"
      >
        <span
          class="lang-ru text-transparent bg-clip-text bg-gradient-to-r from-white via-[var(--color-primary)] to-white bg-300% animate-gradient"
          >Архив Работ</span
        >
        <span
          class="lang-en text-transparent bg-clip-text bg-gradient-to-r from-white via-[var(--color-primary)] to-white bg-300% animate-gradient"
          >Works Archive</span
        >
      </h1>
      <p class="text-xl text-[var(--color-muted-foreground)] max-w-2xl mx-auto">
        <span class="lang-ru"
          >Избранные коммерческие проекты, open-source инструменты и
          эксперименты.</span
        >
        <span class="lang-en"
          >Selected commercial projects, open-source tools, and experiments.</span
        >
      </p>
    </div>

    <!-- Сетка -->
    <!-- Убрали явную типизацию (p: CollectionEntry...) внутри HTML шаблона, чтобы не ломать парсер -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 gap-y-12">
      {
        sortedProjects.map((p, index) => (
          <div
            class="scroll-animate"
            style={`transition-delay: ${index * 50}ms`}
          >
            <ProjectCard project={p} />
          </div>
        ))
      }
    </div>
  </main>
  <Footer />
</Layout>

<style>
  .bg-300\% {
    background-size: 300% auto;
  }
  @keyframes gradient {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }
  .animate-gradient {
    animation: gradient 6s ease infinite;
  }
</style>
